var search_terms;$(document).ready(function(){$(".ml-readmore").on("click",function(){$(this).parent().css({height:"auto","max-height":"none"});$(this).css("display","none");$(this).parent().find("br").css("display","inline")});jQuery.expr[":"].Contains=function(l,n,k){return jQuery(l).text().toUpperCase().indexOf(k[3].toUpperCase())>=0};var j=750;var g=$('<div class="dialog choose_more_dialog"></div>').html("Loading categories...").dialog({autoOpen:false,title:"",width:j,modal:true,position:["center",100]});$(document).on("click","div.ui-widget-overlay",function(){$(".choose_more_dialog").dialog("close")});$(g).on("click","#facetform #btn_cancel",function(){$(".choose_more_dialog").dialog("close")});$(".facet-list-header").on("click",function(){$("span",this).toggleClass("facet-widget-close facet-widget-open");$(".facet-items",this.parentElement).toggle()});g.click(function(k){k.stopPropagation()});function h(k,l){return($('input.selfacet[name="'+k+'"][value="'+decodeURI(l)+'"][checked="checked"]').length>0)}$(".choose-more").on("click",function(l){var k=$(this).attr("data");i(k,$('#search-term input[type="hidden"]').serializeArray(),false);$(".facetlist").each(function(){if($(this).attr("data")!=k){$(this).hide()}else{$("#facetform .top_container .title").text("Loading...");$(this).show()}});g.dialog("open");l.stopPropagation();return false});function i(o,m,k){var n=$.param(m)||"";var l=document.location.href;if(l.indexOf("?")!=-1){l+="&"}else{l+="?"}l+="ignored_facet="+o;if(k){$("#facetform .top_container .title").text(k)}$("#whirligig").css("display","block");$.getJSON(l,function(p){e(p.facet_data,p.facet_names,o);d();if(m){b(m)}})}var a;var f;function e(l,n,u){var k="";var m="";var w="Loading...";var o=0;k="<lh>Choose Categories</lh>";$.each(n,function(y,x){o++;if(y==u){$("#facetform .top_container .title").text(x[0]);w=x[0];k=k+'<li class="showfacet selected"  id="showfacet'+o+'" data="'+y+'"> '+x[0]+"</li>"}else{k=k+'<li class="showfacet" id="showfacet'+o+'" data="'+y+'"> '+x[0]+"</li>"}});var r=new Array();$.each(l,function(C,B){if(typeof B=="undefined"){return true}if(C!=u){m=m+'<ul style="display:none" class="facetlist" data="'+C+'">';var E="display:none;"}else{var E="display:block;";m=m+'<ul class="facetlist" data="'+C+'">'}var A=0;var D=n[C][1];var z=n[C][2];var x=n[C][3];var y=0;if(x==false){$.each(B,function(H,F){if(H=="hr_label"){return}A++;if(F.label){if(D==true){if(C==u){r.push("#facet-selection-"+C+"-"+A)}}var G="";var I=0;if(F.user_pref){G=F.user_pref;I=1;m=m+'<li><input class="facet-'+C+'" type="hidden" id="facet-selection-'+C+"-"+A+'" name="'+G+'" value="0"/></li>'}else{G="facet["+C+"][]";I=escapeHTML(H)}m=m+'<li><input class="facet-'+C+'" type="checkbox" id="facet-selection-'+C+"-"+A+'" name="'+G+'" value="'+I+'"><label for="facet-selection-'+C+"-"+A+'"> '+F.label+'</label><span class="text_theme"> '+(z?"":F.value)+"</span></li>"}})}if(x){m=m+'<li style="width:400px">&nbsp;There are no choices available in this category</li>'}m=m+"</ul>";if(C=="daterange"){m=m+'<div id="date-picker-release-date" style="'+E+'"><div>';m=m+'<span class="startdate-picker">';m=m+'<label for="datepicker-start-dlg" class="datepicker-dlg">From:</label>';m=m+'<div id="datepicker-start-dlg"></div>';m=m+"</span>";m=m+"</div><div>";m=m+'<span class="enddate-picker-dlg">';m=m+'<label for="datepicker-end" class="datepicker-dlg">To:</label>';m=m+'<div id="datepicker-end-dlg"></div>';m=m+"</span>";m=m+'<input type="hidden" id="go-date-dlg" name="facet[daterange][]" value="" /></div></div>'}});var t="";var p=$.query.get("q");var s=["all","label","title","artist","sample packs","equipment_title"];for(v in s){if(p[s[v]]){t+='<input type="hidden" name="q['+s[v]+"][]\" value='"+p[s[v]]+"'/>"}}var q=$.query.get("list_view");if(q){t+='<input type="hidden" name="list_view" value=\''+q+"'/>"}g.html('			<form id="facetform">			<div class="top_container">				<div class="title">'+w+'</div>			</div>			<div class="form_container">				<div id="facet-options-list"><div id="whirligig"></div>'+m+t+'</div>				<div style="display:block;float:left;width:150px;"><ul id="available-facets">'+k+'</ul></div>			</div>			<div class="btm_container">				<input class="btn_theme" id="dialog-filter" type="submit" value="Filter"/>				<input class="btn_subtle" id="btn_cancel" type="button" value="Cancel"/>			</div>			</form>');$("#dialog-filter").on("click",function(){if($("input.facet-daterange").is(":checked")){$("#go-date-dlg").remove()}else{if($("#go-date-dlg").val()==""){$("#go-date-dlg").remove()}}});$(r).each(function(x,y){$(y).on("click",function(){$(r).each(function(A,z){$(z).prop("checked",false)});$(y).prop("checked",true)})});$("#facetform").submit(function(){$("#facetform input:checked").each(function(y,x){x.value=x.value.replace(/\%22/g,'"')});return true});$("#datepicker-start-dlg").datepicker({dateFormat:"dd-mm-yy",yearRange:"1980:+1",defaultDate:a,changeMonth:true,changeYear:true,showOtherMonths:true,selectOtherMonths:true,onSelect:function(x){a=x;$("#datepicker-end-dlg").datepicker("option","minDate",x);load_lightbox_date();clear_daterange_boxes()}}).datepicker("widget").removeClass("ui-corner-all");$("#datepicker-end-dlg").datepicker({dateFormat:"dd-mm-yy",yearRange:"1980:+1",defaultDate:f,changeMonth:true,changeYear:true,showOtherMonths:true,selectOtherMonths:true,onSelect:function(x){f=x;$("#datepicker-start-dlg").datepicker("option","maxDate",x);load_lightbox_date();clear_daterange_boxes()}}).datepicker("widget").removeClass("ui-corner-all")}function d(){$(".showfacet").on("click",function(){var l=$(this).attr("data");if(l!="daterange"){$("#date-picker-release-date").hide()}else{$("#date-picker-release-date").show()}var k=$("#facetform input:checked").serializeArray();i(l,k,$(this).text());$(".facetlist").each(function(){if($(this).attr("data")!=l){$(this).hide()}else{$(this).show()}})})}function b(l){for(var k in l){var m=l[k];$("form#facetform li input").each(function(){if($(this).attr("name")==m.name&&$(this).attr("value")==m.value){$(this).prop("checked",true)}})}}function c(){var k,l;l=window.location.search.replace(/\?/,"").split("&");k={};$.each(l,function(n,m){m=m.split("=");return k[urldecode(m[0])]=urldecode(m[1])});return k}$("#lhs-facets li a.facet-item").each(function(k,l){$(this).on("click",function(){add_overlay("#lhs-facets")})});if(typeof(search_terms)!="undefined"){$.each(search_terms,function(m,l){term=l.split(":");if(term[0].length>0){try{$(".jq_highlight").highlight(l,"highlight-")}catch(k){}}})}});function load_lightbox_date(){var b=convert_date($("#datepicker-start-dlg").val(),"-");var a=convert_date($("#datepicker-end-dlg").val(),"-");if(!a.valueOf()){end_range="*"}else{end_range=a.valueOf()/1000}if(!b.valueOf()){start_range="*"}else{start_range=b.valueOf()/1000}$("#go-date-dlg").val(start_range+"TO"+end_range)}function clear_daterange_boxes(){$("input.facet-daterange").prop("checked",false)}function load_custom_date(){var e=$("#datepicker-start").val();var d=$("#datepicker-end").val();if(!e&&!d){return}if(e){var b=e.split("-");e=new Date(b[2],b[1]-1,b[0]).getTime()/1000}else{e="*"}if(d){var c=d.split("-");d=new Date(c[2],c[1]-1,c[0]).getTime()/1000}else{d="*"}var a=$("#go-date").attr("data-url");a=a+(a.indexOf("?")!=-1?"&":"?");window.location.href=a+"facet[daterange][]="+e+"TO"+d}function convert_date(d,c){var b=d.split(c);var a=new Date(b[2]+"/"+b[1]+"/"+b[0]);return a}jQuery.fn.shorten=function(b){var a={showChars:400,ellipsesText:" ",moreText:"Read More...",lessText:"&laquo; Collapse"};if(b){$.extend(a,b)}$(document).on("click",".morelink",function(){var c=$(this);if(c.hasClass("less")){c.removeClass("less");c.html(a.moreText)}else{c.addClass("less");c.html(a.lessText)}c.parent().prev().toggle();c.prev().toggle();return false});return this.each(function(){var g=$(this);var f=g.html();if(f.length>a.showChars){var i=f.substr(0,a.showChars);var e=f.substr(a.showChars,f.length-a.showChars);var d=i+'<span class="moreellipses">'+a.ellipsesText+'&nbsp;</span><span class="morecontent"><span>'+e+'</span>&nbsp;&nbsp;<a href="javascript://nop/" class="morelink">'+a.moreText+"</a></span>";g.html(d);$(".morecontent span").hide()}})};